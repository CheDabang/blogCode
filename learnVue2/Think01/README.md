# 炒冷饭--直接手撸mini版的Vue2

## 背景
一旦闲下来，就爱瞎想，也爱随便立flag。这不上月刚刚立下不久node学习的flag还热乎，脑袋一热又一冲动，又立了一个要趁vue3出来之前把vue2的源码解读一遍的flag。

flag立都立了，所以总要折腾一下。于是又顺手上天猫买了一本《深入浅出Vue.js》,作为vue源码解读的辅助计划。

看完Object数据侦听，看完很简单，实现起来一脸懵逼。所以这一章先想，结合例子。先来一个简单速成版的demo，帮忙自己巩固双向绑定的原理。

网上搜索了很多篇文章，最后借鉴这位大佬博客博客炒冷饭学习。[大佬博客地址](http://www.cnblogs.com/canfoo/p/6891868.html)

## 简述

+ test01页面，就是简单讲一下`Object.defineProperty`的用法
  
+ test02页面, 第一版实现最简单的数据更新demo

+ test03页面，在第一版基础上面，添加了{{}}基础的模版识别
  
+ tesd04页面，继续扩展，学习vue自定义事件

## 双向绑定的基本构成

在手撸mini版vue2的时候，先让我们来整理一个双向数据绑定的过程。

+ 前面的核心我们已经提到了,利用`Object.defineProperty`,但是直接用，未免粗暴了。毕竟每次手写一大串`ObjectXXXXX`还是挺麻烦的，所以我们用一个函数简单的封装起来. 这里暂时用`defineReactive`

+ 这里如果说一个对象有多个属性如、`title`、`name`..., 后面多了起来不好管理所以我们需要定一个容器来帮助我们存储这些对象的依赖. 这里命名为`Dep`

+ 当然一个对象也有可能是多层结构，有多个子对象。 所以为了保证每一个对象属性都被相应的监听或者依赖，所以这里需要一个函数，递归遍历所有子属性。这里我们取名为`observe`

+ 同时我们需要一个观察者，作为一个喊话的接口。例如下雨了，要提醒那些把衣服晒在外面的要收衣服了。这里取名为`Watcher`

+ 终于来到vue环节，vue里面一些属性，是浏览器所不认识的。例如`{{}}`、`v-model`，所以这里需要一个解释器,来对浏览器解释一下`{{}}`、`v-model`这些是什么意思，代表什么。这里定一个解释器类`Compile`
  
+ 每次调用vue 都是new一个Vue. 所以我们也需要定义一个`Vue`的类，或者叫做构造函数.

### 过程归纳
解释了过程，那么就快速将各个函数或者类过一遍，提高解读思路。

+ `defineReactive` => 封装的`Object.defineProperty`
  
+ `Dep` => 存储各个对象依赖容器

+ `observe` => 递归遍历所有子属性
  
+ `Watcher` => 观察所有属性的变化，一有变化马上通知相应的依赖引用

+ `Compile` => 解析`{{}}`、`v-model`以及自定义指令

+ `Vue` => 用于实例化的数据data等相关用法

## 新知识点DocumentFragment

其实这是一个比较老的知识，是我太菜以前jq一把梭写习惯，从来思考性能是什么东西。

> DocumentFragments 是DOM节点。它们不是主DOM树的一部分。通常的用例是创建文档片段，将元素附加到文档片段，然后将文档片段附加到DOM树。在DOM树中，文档片段被其所有的子元素所代替。
> 
> 因为文档片段存在于内存中，并不在DOM树中，所以将子元素插入到文档片段时不会引起页面回流（对元素位置和几何上的计算）。因此，使用文档片段通常会带来更好的性能。
>
> -- 《MDN语法描述》

## 小结
感觉mini版的vue，更多像是一个加强版的观察者模式+一些语法解析器。看来还得恶补JavaScript基础知识点
